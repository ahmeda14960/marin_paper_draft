{
  "url": "https://api.github.com/repos/marin-community/marin/issues/1368",
  "repository_url": "https://api.github.com/repos/marin-community/marin",
  "labels_url": "https://api.github.com/repos/marin-community/marin/issues/1368/labels{/name}",
  "comments_url": "https://api.github.com/repos/marin-community/marin/issues/1368/comments",
  "events_url": "https://api.github.com/repos/marin-community/marin/issues/1368/events",
  "html_url": "https://github.com/marin-community/marin/issues/1368",
  "id": 3116277302,
  "node_id": "I_kwDOLj5faM65vp42",
  "number": 1368,
  "title": "Experiment: Debug 32B Spiking",
  "user": {
    "login": "dlwh",
    "id": 9633,
    "node_id": "MDQ6VXNlcjk2MzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9633?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dlwh",
    "html_url": "https://github.com/dlwh",
    "followers_url": "https://api.github.com/users/dlwh/followers",
    "following_url": "https://api.github.com/users/dlwh/following{/other_user}",
    "gists_url": "https://api.github.com/users/dlwh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dlwh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dlwh/subscriptions",
    "organizations_url": "https://api.github.com/users/dlwh/orgs",
    "repos_url": "https://api.github.com/users/dlwh/repos",
    "events_url": "https://api.github.com/users/dlwh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dlwh/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 7359276677,
      "node_id": "LA_kwDOLj5faM8AAAABtqWmhQ",
      "url": "https://api.github.com/repos/marin-community/marin/labels/experiment",
      "name": "experiment",
      "color": "1FBEF4",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "dlwh",
    "id": 9633,
    "node_id": "MDQ6VXNlcjk2MzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9633?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dlwh",
    "html_url": "https://github.com/dlwh",
    "followers_url": "https://api.github.com/users/dlwh/followers",
    "following_url": "https://api.github.com/users/dlwh/following{/other_user}",
    "gists_url": "https://api.github.com/users/dlwh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dlwh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dlwh/subscriptions",
    "organizations_url": "https://api.github.com/users/dlwh/orgs",
    "repos_url": "https://api.github.com/users/dlwh/repos",
    "events_url": "https://api.github.com/users/dlwh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dlwh/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "dlwh",
      "id": 9633,
      "node_id": "MDQ6VXNlcjk2MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9633?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dlwh",
      "html_url": "https://github.com/dlwh",
      "followers_url": "https://api.github.com/users/dlwh/followers",
      "following_url": "https://api.github.com/users/dlwh/following{/other_user}",
      "gists_url": "https://api.github.com/users/dlwh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dlwh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dlwh/subscriptions",
      "organizations_url": "https://api.github.com/users/dlwh/orgs",
      "repos_url": "https://api.github.com/users/dlwh/repos",
      "events_url": "https://api.github.com/users/dlwh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dlwh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    {
      "login": "RohithKuditipudi",
      "id": 19682585,
      "node_id": "MDQ6VXNlcjE5NjgyNTg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19682585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RohithKuditipudi",
      "html_url": "https://github.com/RohithKuditipudi",
      "followers_url": "https://api.github.com/users/RohithKuditipudi/followers",
      "following_url": "https://api.github.com/users/RohithKuditipudi/following{/other_user}",
      "gists_url": "https://api.github.com/users/RohithKuditipudi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RohithKuditipudi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RohithKuditipudi/subscriptions",
      "organizations_url": "https://api.github.com/users/RohithKuditipudi/orgs",
      "repos_url": "https://api.github.com/users/RohithKuditipudi/repos",
      "events_url": "https://api.github.com/users/RohithKuditipudi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RohithKuditipudi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2025-06-04T03:54:42Z",
  "updated_at": "2025-10-26T20:01:34Z",
  "closed_at": "2025-07-02T17:47:24Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "Related to #1295 \n\n## Description\n\nWe have been dealing with the loss spikes in Marin 32B for a while now. Unfortunately, this issue is still not fully fixed. In the most recent 2.5k steps, we spent ~130 step in / recovering from spikes, which accounts for approximately 5% of the data. Also, we are concerned that the spikes may have hidden damage on the modelsâ€™ capability that is not reflected in intermediate training loss.\n\nHere is a summary of our current effort and recent plans to understand and further mitigate these spikes.\n\n### Current Observations\n* Adam update norm spikes (2x) precedes loss spikes but not every update norm spike leads to loss spikes.\n* Gradient norms typically spikes after update norm spikes\n* We have already skipped steps with extremely large gradient norms but this does not reduce time to recovery\n* Some more fine-grained preliminary observations\n* The update norm spikes are of higher magnitude on the lower layers compared to the upper layers.\n\nWhen update norm spikes, the second order momentum remains mostly unchanged but the first order momentum increases by 2x\n\n### Current intuition\n\nBecause the update norm spikes precedes both loss and gradient spikes, these spikes are likely not caused by one huge gradient.\nWe therefore conjecture that perhaps for a few consecutive steps before the update norm spike, the gradients are more aligned and have a higher signal to noise ratio. This makes the first order momentum much larger than other steps, and lead to the high update norm.\n\n## TODO\n\n#### Understanding the cause and effect of spikes\n- [x] Replay/ablate batches before update norm blow up to try to localize to a few batches that cause the spikes and check both the examples themselves and how optimizer states evolve [@dlwh]\n- [ ] Cooldown before and after one spike to see how spikes actually impact downstream performance [@RohithKuditipudi ]\n- [x] Add tracker for dead neurons #1367 \n- [ ] something something look at activations\n\n####Potential Mitigation\n\n- [x] Update norm clipping  [@dlwh ]\n- [ ] Manually decreases signal to noise ratio for these steps by adding noise to gradients so there is an upper bound to signal to noise ratio [@RohithKuditipudi ]\n- [ ] Increase the signal to noise ratio for every step so the optimizer get used to high signal to noise ratio by leveraging Nesterov momentum [@WhenWen ]\n- [x] Try different optimizers that have potentially higher stability, such as Muon [@dlwh ]\n\n\n## Hypothesis or Goal\n\nStabilize the 32B and understand why it destabilizes\n\n\n\n## Results\n\nSee #1390 , #1395, https://wandb.ai/marin-community/marin/reports/Marin-32B-Work-In-Progress--VmlldzoxMzM1Mzk1NQ\n\n",
  "closed_by": {
    "login": "dlwh",
    "id": 9633,
    "node_id": "MDQ6VXNlcjk2MzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9633?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dlwh",
    "html_url": "https://github.com/dlwh",
    "followers_url": "https://api.github.com/users/dlwh/followers",
    "following_url": "https://api.github.com/users/dlwh/following{/other_user}",
    "gists_url": "https://api.github.com/users/dlwh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dlwh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dlwh/subscriptions",
    "organizations_url": "https://api.github.com/users/dlwh/orgs",
    "repos_url": "https://api.github.com/users/dlwh/repos",
    "events_url": "https://api.github.com/users/dlwh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dlwh/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/marin-community/marin/issues/1368/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/marin-community/marin/issues/1368/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
